# è‡ªåŠ¨åŒ–æµ‹è¯•ç³»ç»Ÿ

## æ¦‚è¿°

ç»å…¸æ¸¸æˆå¹³å°å·²æ„å»ºå®Œæ•´çš„è‡ªåŠ¨åŒ–æµ‹è¯•ç³»ç»Ÿï¼ŒåŒ…æ‹¬Mockæ•°æ®ç®¡ç†ã€è‡ªåŠ¨åŒ–æµ‹è¯•æ¡†æ¶å’Œæµ‹è¯•è¿è¡Œå™¨ã€‚è¯¥ç³»ç»Ÿæ”¯æŒå‰ç«¯å’Œåç«¯çš„å…¨é¢æµ‹è¯•ï¼Œç¡®ä¿ä»£ç è´¨é‡å’ŒåŠŸèƒ½ç¨³å®šæ€§ã€‚

## ç³»ç»Ÿæ¶æ„

### 1. Mockæ•°æ®ç®¡ç†
- **å‰ç«¯Mockæ•°æ®**: `frontend/src/__mocks__/mockData.js`
- **åç«¯Mockæ•°æ®**: `backend/src/__mocks__/mockData.js`
- **æµ‹è¯•å·¥å…·å‡½æ•°**: `frontend/src/utils/testUtils.js`

### 2. è‡ªåŠ¨åŒ–æµ‹è¯•æ¡†æ¶
- **å‰ç«¯è‡ªåŠ¨åŒ–æµ‹è¯•**: `frontend/src/utils/automatedTests.js`
- **åç«¯è‡ªåŠ¨åŒ–æµ‹è¯•**: `backend/src/utils/automatedTests.js`
- **æµ‹è¯•è¿è¡Œå™¨**: `run-automated-tests.js`

### 3. æµ‹è¯•é…ç½®
- **å‰ç«¯Jesté…ç½®**: `frontend/jest.config.js`
- **åç«¯Jesté…ç½®**: `backend/jest.config.js`
- **æµ‹è¯•ç¯å¢ƒè®¾ç½®**: `frontend/src/setupTests.js`, `backend/src/setupTests.js`

## Mockæ•°æ®ç³»ç»Ÿ

### å‰ç«¯Mockæ•°æ®

#### ç”¨æˆ·æ•°æ®
```javascript
export const mockUsers = {
  testUser: { /* æµ‹è¯•ç”¨æˆ·æ•°æ® */ },
  adminUser: { /* ç®¡ç†å‘˜ç”¨æˆ·æ•°æ® */ },
  newUser: { /* æ–°ç”¨æˆ·æ•°æ® */ },
  premiumUser: { /* é«˜çº§ç”¨æˆ·æ•°æ® */ }
};
```

#### æ¸¸æˆæ•°æ®
```javascript
export const mockGames = {
  tetris: { /* ä¿„ç½—æ–¯æ–¹å—æ¸¸æˆæ•°æ® */ },
  snake: { /* è´ªåƒè›‡æ¸¸æˆæ•°æ® */ },
  breakout: { /* æ‰“ç –å—æ¸¸æˆæ•°æ® */ }
};
```

#### æ¸¸æˆæˆ¿é—´æ•°æ®
```javascript
export const mockGameRooms = {
  waitingRoom: { /* ç­‰å¾…ä¸­çš„æˆ¿é—´ */ },
  activeRoom: { /* æ¸¸æˆä¸­çš„æˆ¿é—´ */ },
  finishedRoom: { /* å·²ç»“æŸçš„æˆ¿é—´ */ }
};
```

#### ç¤¾äº¤æ•°æ®
```javascript
export const mockSocial = {
  friends: [ /* å¥½å‹åˆ—è¡¨ */ ],
  friendRequests: [ /* å¥½å‹è¯·æ±‚ */ ],
  guilds: [ /* å…¬ä¼šæ•°æ® */ ]
};
```

### åç«¯Mockæ•°æ®

#### æ•°æ®åº“æ¨¡å‹æ•°æ®
```javascript
const mockUsers = [ /* ç”¨æˆ·æ•°ç»„ */ ];
const mockGames = [ /* æ¸¸æˆæ•°ç»„ */ ];
const mockScores = [ /* åˆ†æ•°è®°å½•æ•°ç»„ */ ];
const mockGameRooms = [ /* æ¸¸æˆæˆ¿é—´æ•°ç»„ */ ];
const mockFriendships = [ /* å¥½å‹å…³ç³»æ•°ç»„ */ ];
```

#### æŸ¥è¯¢ç»“æœæ¨¡æ‹Ÿ
```javascript
const mockQueryResults = {
  findUserByUsername: (username) => { /* æŒ‰ç”¨æˆ·åæŸ¥æ‰¾ç”¨æˆ· */ },
  findGameById: (id) => { /* æŒ‰IDæŸ¥æ‰¾æ¸¸æˆ */ },
  findScoresByGameId: (gameId) => { /* æŒ‰æ¸¸æˆIDæŸ¥æ‰¾åˆ†æ•° */ }
};
```

## è‡ªåŠ¨åŒ–æµ‹è¯•æ¡†æ¶

### å‰ç«¯è‡ªåŠ¨åŒ–æµ‹è¯•

#### æ¸¸æˆç»„ä»¶æµ‹è¯•
```javascript
class GameAutomatedTests extends AutomatedTestSuite {
  setupTests() {
    this.addTest('ä¿„ç½—æ–¯æ–¹å—ç»„ä»¶æ¸²æŸ“æµ‹è¯•', this.testTetrisRendering);
    this.addTest('ä¿„ç½—æ–¯æ–¹å—æ¸¸æˆæµç¨‹æµ‹è¯•', this.testTetrisGameFlow);
    this.addTest('ä¿„ç½—æ–¯æ–¹å—é”®ç›˜æ§åˆ¶æµ‹è¯•', this.testTetrisControls);
    // ... æ›´å¤šæµ‹è¯•
  }
}
```

#### é¡µé¢ç»„ä»¶æµ‹è¯•
```javascript
class PageAutomatedTests extends AutomatedTestSuite {
  setupTests() {
    this.addTest('æ¸¸æˆé€‰æ‹©é¡µé¢æµ‹è¯•', this.testGameSelectionPage);
    this.addTest('æ¸¸æˆå¤§å…é¡µé¢æµ‹è¯•', this.testGameHallPage);
    this.addTest('æ’è¡Œæ¦œé¡µé¢æµ‹è¯•', this.testLeaderboardPage);
    // ... æ›´å¤šæµ‹è¯•
  }
}
```

#### ReduxçŠ¶æ€æµ‹è¯•
```javascript
class ReduxAutomatedTests extends AutomatedTestSuite {
  setupTests() {
    this.addTest('è®¤è¯çŠ¶æ€æµ‹è¯•', this.testAuthState);
    this.addTest('æ¸¸æˆçŠ¶æ€æµ‹è¯•', this.testGameState);
    this.addTest('æ’è¡Œæ¦œçŠ¶æ€æµ‹è¯•', this.testLeaderboardState);
    // ... æ›´å¤šæµ‹è¯•
  }
}
```

### åç«¯è‡ªåŠ¨åŒ–æµ‹è¯•

#### APIè·¯ç”±æµ‹è¯•
```javascript
class APIAutomatedTests extends AutomatedTestSuite {
  setupTests() {
    this.addTest('ç”¨æˆ·æ³¨å†ŒAPIæµ‹è¯•', this.testUserRegistration);
    this.addTest('ç”¨æˆ·ç™»å½•APIæµ‹è¯•', this.testUserLogin);
    this.addTest('è·å–æ¸¸æˆåˆ—è¡¨APIæµ‹è¯•', this.testGetGames);
    // ... æ›´å¤šæµ‹è¯•
  }
}
```

#### æ•°æ®åº“æ“ä½œæµ‹è¯•
```javascript
class DatabaseAutomatedTests extends AutomatedTestSuite {
  setupTests() {
    this.addTest('ç”¨æˆ·æŸ¥è¯¢æµ‹è¯•', this.testUserQueries);
    this.addTest('æ¸¸æˆæŸ¥è¯¢æµ‹è¯•', this.testGameQueries);
    this.addTest('åˆ†æ•°æŸ¥è¯¢æµ‹è¯•', this.testScoreQueries);
    // ... æ›´å¤šæµ‹è¯•
  }
}
```

#### ä¸­é—´ä»¶æµ‹è¯•
```javascript
class MiddlewareAutomatedTests extends AutomatedTestSuite {
  setupTests() {
    this.addTest('è®¤è¯ä¸­é—´ä»¶æµ‹è¯•', this.testAuthMiddleware);
    this.addTest('é”™è¯¯å¤„ç†ä¸­é—´ä»¶æµ‹è¯•', this.testErrorHandlerMiddleware);
    this.addTest('CORSä¸­é—´ä»¶æµ‹è¯•', this.testCORSMiddleware);
    // ... æ›´å¤šæµ‹è¯•
  }
}
```

## è¿è¡Œè‡ªåŠ¨åŒ–æµ‹è¯•

### 1. è¿è¡Œæ‰€æœ‰æµ‹è¯•
```bash
node run-automated-tests.js
```

### 2. è¿è¡Œç‰¹å®šæµ‹è¯•
```bash
# åªè¿è¡Œå‰ç«¯æµ‹è¯•
node run-automated-tests.js --frontend-only

# åªè¿è¡Œåç«¯æµ‹è¯•
node run-automated-tests.js --backend-only

# åªè¿è¡ŒJestæµ‹è¯•
node run-automated-tests.js --jest-only

# åªè¿è¡Œè‡ªåŠ¨åŒ–æµ‹è¯•
node run-automated-tests.js --automated-only
```

### 3. æŸ¥çœ‹å¸®åŠ©
```bash
node run-automated-tests.js --help
```

## æµ‹è¯•è¦†ç›–èŒƒå›´

### å‰ç«¯æµ‹è¯•è¦†ç›–
- âœ… ç»„ä»¶æ¸²æŸ“æµ‹è¯•
- âœ… ç”¨æˆ·äº¤äº’æµ‹è¯•
- âœ… æ¸¸æˆé€»è¾‘æµ‹è¯•
- âœ… é”®ç›˜äº‹ä»¶æµ‹è¯•
- âœ… çŠ¶æ€ç®¡ç†æµ‹è¯•
- âœ… è·¯ç”±å¯¼èˆªæµ‹è¯•
- âœ… å¼‚æ­¥æ“ä½œæµ‹è¯•
- âœ… é”™è¯¯å¤„ç†æµ‹è¯•

### åç«¯æµ‹è¯•è¦†ç›–
- âœ… APIç«¯ç‚¹æµ‹è¯•
- âœ… è¯·æ±‚éªŒè¯æµ‹è¯•
- âœ… æ•°æ®åº“æ“ä½œæµ‹è¯•
- âœ… ä¸­é—´ä»¶åŠŸèƒ½æµ‹è¯•
- âœ… è®¤è¯æˆæƒæµ‹è¯•
- âœ… é”™è¯¯å¤„ç†æµ‹è¯•
- âœ… æ–‡ä»¶ä¸Šä¼ æµ‹è¯•
- âœ… é‚®ä»¶å‘é€æµ‹è¯•

## æµ‹è¯•æ•°æ®ç®¡ç†

### æ•°æ®åˆ†ç±»
1. **ç”¨æˆ·æ•°æ®**: ä¸åŒè§’è‰²çš„ç”¨æˆ·ä¿¡æ¯
2. **æ¸¸æˆæ•°æ®**: æ¸¸æˆé…ç½®å’ŒçŠ¶æ€ä¿¡æ¯
3. **æˆ¿é—´æ•°æ®**: æ¸¸æˆæˆ¿é—´å’Œç©å®¶ä¿¡æ¯
4. **åˆ†æ•°æ•°æ®**: æ¸¸æˆåˆ†æ•°å’Œæ’è¡Œæ¦œæ•°æ®
5. **ç¤¾äº¤æ•°æ®**: å¥½å‹å…³ç³»å’Œå…¬ä¼šä¿¡æ¯
6. **é€šçŸ¥æ•°æ®**: ç³»ç»Ÿé€šçŸ¥å’Œæ¶ˆæ¯
7. **æˆå°±æ•°æ®**: ç”¨æˆ·æˆå°±å’Œè¿›åº¦

### æ•°æ®æ›´æ–°ç­–ç•¥
- å®šæœŸæ›´æ–°Mockæ•°æ®ä»¥åæ˜ æœ€æ–°çš„ä¸šåŠ¡é€»è¾‘
- æ·»åŠ æ–°çš„æµ‹è¯•åœºæ™¯å’Œæ•°æ®ç»„åˆ
- ç»´æŠ¤æ•°æ®çš„ä¸€è‡´æ€§å’Œå®Œæ•´æ€§

## æµ‹è¯•æœ€ä½³å®è·µ

### 1. æµ‹è¯•ç¼–å†™åŸåˆ™
- **ç‹¬ç«‹æ€§**: æ¯ä¸ªæµ‹è¯•åº”è¯¥ç‹¬ç«‹è¿è¡Œï¼Œä¸ä¾èµ–å…¶ä»–æµ‹è¯•
- **å¯é‡å¤æ€§**: æµ‹è¯•ç»“æœåº”è¯¥ä¸€è‡´ï¼Œä¸å—å¤–éƒ¨å› ç´ å½±å“
- **å®Œæ•´æ€§**: æµ‹è¯•åº”è¯¥è¦†ç›–æ‰€æœ‰é‡è¦çš„åŠŸèƒ½å’Œè¾¹ç•Œæƒ…å†µ
- **å¯ç»´æŠ¤æ€§**: æµ‹è¯•ä»£ç åº”è¯¥æ¸…æ™°ã€æ˜“äºç†è§£å’Œç»´æŠ¤

### 2. Mockæ•°æ®ä½¿ç”¨
- ä½¿ç”¨å›ºå®šçš„Mockæ•°æ®ç¡®ä¿æµ‹è¯•ä¸€è‡´æ€§
- ä¸ºä¸åŒçš„æµ‹è¯•åœºæ™¯å‡†å¤‡ä¸åŒçš„æ•°æ®ç»„åˆ
- é¿å…åœ¨æµ‹è¯•ä¸­ä¿®æ”¹Mockæ•°æ®
- å®šæœŸæ¸…ç†å’Œæ›´æ–°Mockæ•°æ®

### 3. å¼‚æ­¥æµ‹è¯•å¤„ç†
- ä½¿ç”¨ `waitFor` å¤„ç†å¼‚æ­¥æ“ä½œ
- æ­£ç¡®æ¨¡æ‹Ÿå¼‚æ­¥APIè°ƒç”¨
- å¤„ç†è¶…æ—¶å’Œé”™è¯¯æƒ…å†µ
- éªŒè¯å¼‚æ­¥æ“ä½œçš„ç»“æœ

### 4. é”™è¯¯æµ‹è¯•
- æµ‹è¯•å„ç§é”™è¯¯æƒ…å†µå’Œè¾¹ç•Œæ¡ä»¶
- éªŒè¯é”™è¯¯æ¶ˆæ¯å’ŒçŠ¶æ€ç 
- æµ‹è¯•é”™è¯¯æ¢å¤æœºåˆ¶
- ç¡®ä¿é”™è¯¯ä¸ä¼šå½±å“å…¶ä»–åŠŸèƒ½

## æŒç»­é›†æˆ

### GitHub Actionsé…ç½®
```yaml
name: Automated Tests
on: [push, pull_request]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - uses: actions/setup-node@v2
        with:
          node-version: '18'
      - run: node run-automated-tests.js
      - name: Upload coverage
        uses: codecov/codecov-action@v2
```

### æµ‹è¯•æŠ¥å‘Š
- è‡ªåŠ¨ç”Ÿæˆæµ‹è¯•è¦†ç›–ç‡æŠ¥å‘Š
- è®°å½•æµ‹è¯•æ‰§è¡Œæ—¶é—´å’Œç»“æœ
- æä¾›è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯å’Œå †æ ˆè·Ÿè¸ª
- æ”¯æŒå¤šç§æŠ¥å‘Šæ ¼å¼ï¼ˆHTMLã€JSONã€XMLï¼‰

## æ€§èƒ½æµ‹è¯•

### å‰ç«¯æ€§èƒ½æµ‹è¯•
- ç»„ä»¶æ¸²æŸ“æ€§èƒ½
- æ¸¸æˆè¿è¡Œæ€§èƒ½
- å†…å­˜ä½¿ç”¨æƒ…å†µ
- ç½‘ç»œè¯·æ±‚æ€§èƒ½

### åç«¯æ€§èƒ½æµ‹è¯•
- APIå“åº”æ—¶é—´
- æ•°æ®åº“æŸ¥è¯¢æ€§èƒ½
- å¹¶å‘å¤„ç†èƒ½åŠ›
- èµ„æºä½¿ç”¨æƒ…å†µ

## å®‰å…¨æµ‹è¯•

### å‰ç«¯å®‰å…¨æµ‹è¯•
- XSSæ”»å‡»é˜²æŠ¤
- CSRFæ”»å‡»é˜²æŠ¤
- è¾“å…¥éªŒè¯æµ‹è¯•
- æƒé™æ§åˆ¶æµ‹è¯•

### åç«¯å®‰å…¨æµ‹è¯•
- SQLæ³¨å…¥é˜²æŠ¤
- è®¤è¯æˆæƒæµ‹è¯•
- è¾“å…¥éªŒè¯æµ‹è¯•
- æ–‡ä»¶ä¸Šä¼ å®‰å…¨æµ‹è¯•

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜
1. **æµ‹è¯•ç¯å¢ƒé—®é¢˜**: ç¡®ä¿Node.jsç‰ˆæœ¬å’Œä¾èµ–åŒ…æ­£ç¡®å®‰è£…
2. **Mockæ•°æ®é—®é¢˜**: æ£€æŸ¥Mockæ•°æ®æ ¼å¼å’Œå®Œæ•´æ€§
3. **å¼‚æ­¥æµ‹è¯•é—®é¢˜**: ç¡®ä¿æ­£ç¡®ä½¿ç”¨waitForå’Œå¼‚æ­¥å¤„ç†
4. **ç¯å¢ƒå˜é‡é—®é¢˜**: ç¡®ä¿æµ‹è¯•ç¯å¢ƒå˜é‡æ­£ç¡®è®¾ç½®

### è°ƒè¯•æŠ€å·§
- ä½¿ç”¨ `console.log` è¾“å‡ºè°ƒè¯•ä¿¡æ¯
- æ£€æŸ¥æµ‹è¯•æ‰§è¡Œæ—¥å¿—
- éªŒè¯Mockæ•°æ®æ˜¯å¦æ­£ç¡®åŠ è½½
- ç¡®è®¤æµ‹è¯•ç¯å¢ƒé…ç½®

## æ‰©å±•æŒ‡å—

### æ·»åŠ æ–°çš„æµ‹è¯•ç”¨ä¾‹
1. åœ¨ç›¸åº”çš„æµ‹è¯•ç±»ä¸­æ·»åŠ æ–°çš„æµ‹è¯•æ–¹æ³•
2. å‡†å¤‡å¿…è¦çš„Mockæ•°æ®
3. ç¼–å†™æµ‹è¯•é€»è¾‘å’Œæ–­è¨€
4. è¿è¡Œæµ‹è¯•éªŒè¯ç»“æœ

### æ·»åŠ æ–°çš„Mockæ•°æ®
1. åœ¨Mockæ•°æ®æ–‡ä»¶ä¸­æ·»åŠ æ–°çš„æ•°æ®ç»“æ„
2. ç¡®ä¿æ•°æ®æ ¼å¼æ­£ç¡®
3. æ›´æ–°ç›¸å…³çš„æŸ¥è¯¢æ–¹æ³•
4. åœ¨æµ‹è¯•ä¸­ä½¿ç”¨æ–°çš„Mockæ•°æ®

### è‡ªå®šä¹‰æµ‹è¯•æ¡†æ¶
1. ç»§æ‰¿ `AutomatedTestSuite` ç±»
2. å®ç°è‡ªå®šä¹‰çš„æµ‹è¯•é€»è¾‘
3. æ·»åŠ ç‰¹å®šçš„æµ‹è¯•å·¥å…·å’Œæ–¹æ³•
4. é›†æˆåˆ°æµ‹è¯•è¿è¡Œå™¨ä¸­

## æ€»ç»“

è‡ªåŠ¨åŒ–æµ‹è¯•ç³»ç»Ÿä¸ºç»å…¸æ¸¸æˆå¹³å°æä¾›äº†å…¨é¢çš„æµ‹è¯•è¦†ç›–ï¼Œç¡®ä¿ä»£ç è´¨é‡å’ŒåŠŸèƒ½ç¨³å®šæ€§ã€‚é€šè¿‡Mockæ•°æ®ç®¡ç†å’Œè‡ªåŠ¨åŒ–æµ‹è¯•æ¡†æ¶ï¼Œå¯ä»¥å¿«é€Ÿã€å¯é åœ°éªŒè¯ç³»ç»ŸåŠŸèƒ½ï¼Œæé«˜å¼€å‘æ•ˆç‡å’Œä»£ç è´¨é‡ã€‚

ç³»ç»Ÿç‰¹ç‚¹ï¼š
- ğŸ¯ **å…¨é¢è¦†ç›–**: è¦†ç›–å‰ç«¯å’Œåç«¯çš„æ‰€æœ‰é‡è¦åŠŸèƒ½
- ğŸš€ **è‡ªåŠ¨åŒ–è¿è¡Œ**: æ”¯æŒä¸€é”®è¿è¡Œæ‰€æœ‰æµ‹è¯•
- ğŸ“Š **è¯¦ç»†æŠ¥å‘Š**: æä¾›è¯¦ç»†çš„æµ‹è¯•ç»“æœå’Œè¦†ç›–ç‡æŠ¥å‘Š
- ğŸ”§ **æ˜“äºæ‰©å±•**: æ”¯æŒæ·»åŠ æ–°çš„æµ‹è¯•ç”¨ä¾‹å’ŒMockæ•°æ®
- ğŸ›¡ï¸ **è´¨é‡ä¿è¯**: ç¡®ä¿ä»£ç è´¨é‡å’ŒåŠŸèƒ½ç¨³å®šæ€§

é€šè¿‡æŒç»­ä½¿ç”¨å’Œç»´æŠ¤è¿™ä¸ªè‡ªåŠ¨åŒ–æµ‹è¯•ç³»ç»Ÿï¼Œå¯ä»¥å¤§å¤§æé«˜é¡¹ç›®çš„å¼€å‘æ•ˆç‡å’Œä»£ç è´¨é‡ã€‚ 